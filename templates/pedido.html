{% extends "base.html" %}
{% block title %}Novo Pedido - Sistema de Representação{% endblock %}
{% block content %}
    <div class="container mt-3">
        <h1>Novo Pedido - {{ pedido.empresa.nome }}</h1>
        <form method="POST" action="{{ url_for('pedido') }}" class="mb-3">
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="empresa" class="form-label">Empresa:</label>
                    <select class="form-select" id="empresa" name="empresa" disabled>
                        <option value="{{ pedido.empresa.nome }}" selected>{{ pedido.empresa.nome }}</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="cnpj" class="form-label">CNPJ:</label>
                    <input type="text" class="form-control" id="cnpj" name="cnpj" value="{{ pedido.cnpj }}" required>
                </div>
                <div class="col-md-4">
                    <label for="razao" class="form-label">Razão Social:</label>
                    <input type="text" class="form-control" id="razao" name="razao" value="{{ pedido.razao_social }}" required>
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-primary">Atualizar Dados do Pedido</button>
                </div>
            </div>
        </form>

        <h2>Itens do Pedido</h2>
        {% if pedido.itens %}
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Código</th>
                        <th>Descritivo</th>
                        <th>Quantidades</th>
                        <th>Valor Unitário</th>
                        <th>Total</th>
                        <th>Ação</th>
                    </tr>
                </thead>
                <tbody>
                    {% for i, item in pedido.itens|enumerate %}
                    <tr>
                        <td>{{ item.codigo }}</td>
                        <td>{{ pedido.empresa.catalogo[item.codigo].descritivo }}</td>
                        <td>{{ item.quantidades|join(', ') }}</td>
                        <td>{{ pedido.empresa.catalogo[item.codigo].valor }}</td>
                        <td>{{ "%.2f"|format((pedido.empresa.catalogo[item.codigo].valor * item.quantidades.values()|sum)) }}</td>
                        <td>
                            <a href="{{ url_for('remover_item', index=i) }}" class="btn btn-danger btn-sm">Remover</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>Nenhum item adicionado ao pedido.</p>
        {% endif %}

        <h2>Adicionar Item</h2>
        <form method="POST" action="{{ url_for('adicionar_item') }}" class="row g-3">
            <div class="col-md-3">
                <label for="codigo" class="form-label">Código:</label>
                <input type="text" class="form-control" id="codigo" name="codigo" required>
            </div>
            {% if pedido.empresa.catalogo %}
                {% for tam in pedido.empresa.catalogo.values()|first.tamanhos %}
                <div class="col-md-2">
                    <label for="qtd_{{ tam }}" class="form-label">Qtd {{ tam }}:</label>
                    <input type="number" class="form-control" id="qtd_{{ tam }}" name="qtd_{{ tam }}" min="0" value="0">
                </div>
                {% endfor %}
            {% endif %}
            <div class="col-12">
                <button type="submit" class="btn btn-success">Adicionar Item</button>
            </div>
        </form>
    </div>
{% endblock %}